!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("logootish-js",[],e):"object"==typeof exports?exports["logootish-js"]=e():t["logootish-js"]=e()}("undefined"!=typeof self?self:this,(function(){return function(t){var e={};function o(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,o),s.l=!0,s.exports}return o.m=t,o.c=e,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)o.d(n,s,function(e){return t[e]}.bind(null,s));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=2)}([function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.arraymap=function(t,e){for(let o=0;o<t.length;){const n=e(t[o]);t.splice(o,1,...n),o+=n.length?n.length:1}return t};class n extends Error{constructor(){super(...arguments),this.fatal=!0}}e.FatalError=n;e.Comparable=class{gt(t){return 1===this.cmp(t)}gteq(t){return this.cmp(t)>=0}eq(t){return 0===this.cmp(t)}lteq(t){return this.cmp(t)<=0}lt(t){return-1===this.cmp(t)}};e.MemberPtr=class{constructor(t,e){this.obj=t,this.key=e}get value(){return this.obj[this.key]}set value(t){this.obj[this.key]=t}}},function(t,e,o){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=n(o(3)).default.getLogger("logootish-js");e.debug=s},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=o(1),s=o(4);var r,i;e.ListDocumentModel=s.ListDocumentModel,e.LogootInt=s.LogootInt,e.LogootPosition=s.LogootPosition,function(t){t[t.PENDING=0]="PENDING",t[t.SENDING=1]="SENDING",t[t.COMPLETE=2]="COMPLETE"}(r||(r={})),e.EventState=r,function(t){t[t.INSERTION=0]="INSERTION",t[t.REMOVAL=1]="REMOVAL"}(i||(i={})),e.EventType=i;class l{constructor(t,e=new s.LogootPosition,o){this.type=i.INSERTION,this.body="",this.start=void 0,this.rclk=new s.LogootInt,this.last=void 0,this.next=void 0,this.state=r.PENDING,Object.assign(this,{body:t,start:e,rclk:new s.LogootInt(o)})}static fromJSON(t){return new l(t.body,s.LogootPosition.fromJSON(t.start),s.LogootInt.fromJSON(t.rclk))}toJSON(){return{body:this.body,start:this.start.toJSON(),rclk:this.rclk.toJSON()}}get length(){return this.body.length}get end(){return this.start.offsetLowest(this.length)}}e.InsertionEvent=l,function(t){let e;!function(t){t.Schema={type:"object",properties:{body:{type:"string"},start:s.LogootPosition.JSON.Schema,rclk:s.LogootInt.JSON.Schema}}}(e=t.JSON||(t.JSON={}))}(l||(l={})),e.InsertionEvent=l;class a{constructor(t,e){this.type=i.REMOVAL,this.removals=[],this.state=r.PENDING,this.removals=t,this.rclk=new s.LogootInt(e)}static fromJSON(t){return new a(t.removals.map(t=>({start:s.LogootPosition.fromJSON(t.start),length:t.length})),s.LogootInt.fromJSON(t.rclk))}toJSON(){return{removals:this.removals.map(t=>({start:t.start.toJSON(),length:t.length})),rclk:this.rclk.toJSON()}}}e.RemovalEvent=a,function(t){let e;!function(t){t.Schema={type:"object",properties:{removals:{type:"array",items:{type:"object",properties:{start:s.LogootPosition.JSON.Schema,length:{type:"number"}}}},rclk:s.LogootInt.JSON.Schema}}}(e=t.JSON||(t.JSON={}))}(a||(a={})),e.RemovalEvent=a;e.Document=class{constructor(t,e,o){this.pending_events=[],this._active_listeners=[],this.last_insertion_event=void 0,this.doc=new s.ListDocumentModel,this.send=t,this.insertLocal=e,this.removeLocal=o}_removePendingEvent(t){const e=this.pending_events.indexOf(t);return e>=0&&(this.pending_events.splice(e,1),!0)}_tryMergeEvents(t){if(t.state!==r.PENDING)return!1;if(t.last&&t.last.state===r.PENDING){let e=t;for(;e.last&&e.last.state===r.PENDING;)e.last.body+=e.body,e.last.next=e.next,e.next&&(e.next.last=e.last),this._removePendingEvent(e),this.last_insertion_event===e&&(this.last_insertion_event=e.last),e=e.last;return this._tryMergeEvents(e),!0}if(t.next&&t.next.state===r.PENDING){let e=t;for(;e.next&&e.next.state===r.PENDING;)e.next.body=e.body+e.next.body,e.next.start=e.start,e.next.last=e.last,e.last&&(e.last.next=e.next),this._removePendingEvent(e),this.last_insertion_event===e&&(this.last_insertion_event=e.next),e=e.next;return!0}return!1}_pushEvent(t){this.pending_events.push(t);const e=()=>{t.state=r.SENDING,this.send(t).then(()=>{this._removePendingEvent(t),t.state=r.COMPLETE}).catch(o=>(t.state=r.PENDING,o.event&&o.event.flagCancelled(),o&&o.data&&o.data.retry_after_ms?t.type===i.INSERTION&&this._tryMergeEvents(t)?(n.debug.warn(`Hitting the rate limit: Will resend in ${o.data.retry_after_ms} ms with multiple messages merged together`),{}):(n.debug.warn(`Hitting the rate limit: Will resend in ${o.data.retry_after_ms} ms`),void setTimeout(e,o.data.retry_after_ms)):(n.debug.error("Error sending event",o),o)))};e()}get ldoc_bst(){return this.ldoc_bst}get logoot_bst(){return this.logoot_bst}get removal_bst(){return this.removal_bst}insert(t,e){const o=this.doc.insertLocal(t,e.length);this._pushEvent(new l(e,o.position,o.rclk))}remove(t,e){const{removals:o,rclk:n}=this.doc.removeLocal(t,e);this._pushEvent(new a(o,n))}remoteInsert(t){const{body:e,start:o,rclk:n}=l.fromJSON(t),{insertions:s}=this.doc.insertLogoot(o,e.length,n);s.forEach(({offset:t,length:o,known_position:n})=>this.insertLocal(n,e.substr(t,o)))}remoteRemove(t){const{rclk:e,removals:o}=a.fromJSON(t);o.forEach(({start:t,length:o})=>{const{removals:n}=this.doc.removeLogoot(t,o,e);n.forEach(({known_position:t,length:e})=>this.removeLocal(t,e))})}}},function(t,e,o){var n,s;!function(r,i){"use strict";void 0===(s="function"==typeof(n=function(){var t=function(){},e="undefined",o=typeof window!==e&&/Trident\/|MSIE /.test(window.navigator.userAgent),n=["trace","debug","info","warn","error"];function s(t,e){var o=t[e];if("function"==typeof o.bind)return o.bind(t);try{return Function.prototype.bind.call(o,t)}catch(e){return function(){return Function.prototype.apply.apply(o,[t,arguments])}}}function r(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function i(e,o){for(var s=0;s<n.length;s++){var r=n[s];this[r]=s<e?t:this.methodFactory(r,e,o)}this.log=this.debug}function l(t,o,n){return function(){typeof console!==e&&(i.call(this,o,n),this[t].apply(this,arguments))}}function a(n,i,a){return function(n){return"debug"===n&&(n="log"),typeof console!==e&&("trace"===n&&o?r:void 0!==console[n]?s(console,n):void 0!==console.log?s(console,"log"):t)}(n)||l.apply(this,arguments)}function c(t,o,s){var r,l=this,c="loglevel";function h(){var t;if(typeof window!==e){try{t=window.localStorage[c]}catch(t){}if(typeof t===e)try{var o=window.document.cookie,n=o.indexOf(encodeURIComponent(c)+"=");-1!==n&&(t=/^([^;]+)/.exec(o.slice(n))[1])}catch(t){}return void 0===l.levels[t]&&(t=void 0),t}}t&&(c+=":"+t),l.name=t,l.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},l.methodFactory=s||a,l.getLevel=function(){return r},l.setLevel=function(o,s){if("string"==typeof o&&void 0!==l.levels[o.toUpperCase()]&&(o=l.levels[o.toUpperCase()]),!("number"==typeof o&&o>=0&&o<=l.levels.SILENT))throw"log.setLevel() called with invalid level: "+o;if(r=o,!1!==s&&function(t){var o=(n[t]||"silent").toUpperCase();if(typeof window!==e){try{return void(window.localStorage[c]=o)}catch(t){}try{window.document.cookie=encodeURIComponent(c)+"="+o+";"}catch(t){}}}(o),i.call(l,o,t),typeof console===e&&o<l.levels.SILENT)return"No console available for logging"},l.setDefaultLevel=function(t){h()||l.setLevel(t,!1)},l.enableAll=function(t){l.setLevel(l.levels.TRACE,t)},l.disableAll=function(t){l.setLevel(l.levels.SILENT,t)};var u=h();null==u&&(u=null==o?"WARN":o),l.setLevel(u,!1)}var h=new c,u={};h.getLogger=function(t){if("string"!=typeof t||""===t)throw new TypeError("You must supply a name when creating a logger.");var e=u[t];return e||(e=u[t]=new c(t,h.getLevel(),h.methodFactory)),e};var d=typeof window!==e?window.log:void 0;return h.noConflict=function(){return typeof window!==e&&window.log===h&&(window.log=d),h},h.getLoggers=function(){return u},h})?n.call(e,o,e,t):n)||(t.exports=s)}()},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=o(0),s=o(1),r=o(5),i=o(6);function l(t,e,o,s,r,l){const a=e.levels,c=e.offsetLowest(o);let h=t.getRange({start:e},{start:c}).map(({data:t})=>t).sort((t,e)=>t.start.cmp(e.start));const u=t.getLteq({start:e});let d;if(u.length>1)throw new n.FatalError("Corrupt BST. There are multiple nodes at a position.");u.length&&(d=u[0].data),d&&!h.includes(d)&&h.unshift(d),h.push({start:c,end:c,length:0,known_position:0,known_end_position:0,rclk:new i.LogootInt(0)}),h=h.filter(t=>{if(t.length&&t.start.levels===a){const o=e.cmp(t.start)>0,n=c.cmp(t.end)<0,h=o?e:t.start,u=n?c:t.end;if(0===h.cmp(u))return!0;const g={start:h,end:u,clip_nstart:o,clip_nend:n,whole_node:!(o||n),level:a},p=s(t,g,d);if(p<1){if(p<0)if(g.whole_node)l(t,t.known_position,t.length,!0),t.length=0;else{const e=new i.LogootInt(u.l(a)).sub(h.l(a)).js_int,s=new i.LogootNode(t);s.start=u;const c=t.end.offsetLowest(0);o?(t.length=new i.LogootInt(h.l(a)).sub(t.start.l(a)).js_int,s.known_position+=t.length,s.start.offsetLowest(t.known_position+t.length+e),l(t,t.known_position+t.length,e,t.length<=0)):(l(t,t.known_position,e,!0),s.start.offsetLowest(t.known_position+e)),n&&(s.length=new i.LogootInt(c.l(a)).sub(u.l(a)).js_int,s.length>0&&r(s))}return!1}}return!0});let g=0;if(d){const t=[d.length];d.start.levels<e.levels&&t.push(new i.LogootInt(e.l(d.start.levels)).sub(d.start.l(d.start.levels)).js_int);const o=Math.min(...t);if(g=d.known_position+o,d.length-o){const t=new i.LogootNode(d);t.start=t.start.offsetLowest(o),t.length-=o,t.known_position+=o,r(t),d.length=o}}const p=[];let f=e,v=g;return h.forEach(t=>{const{start:o,end:n,length:s}=t,r=o.equivalentPositionAtLevel(a).clamp(e,c),l=n.equivalentPositionAtLevel(a).clamp(e,c),h=new i.LogootInt(f.l(a)).sub(e.l(a)).js_int,u=Object.assign(new i.LogootNode,{offset:h});if(u.length=new i.LogootInt(r.l(a)).sub(f.l(a)).js_int,u.length<=0)return f=l,void(t!==d&&(v+=s));u.start=e.offsetLowest(h),u.known_position=v,p.push(u),f=l,v+=u.length,t!==d&&(v+=s)}),p}e.LogootInt=i.LogootInt,e.LogootPosition=i.LogootPosition,e._mergeNode=l;e.ListDocumentModel=class{constructor(){this.ldoc_bst=new r.Bst((t,e)=>t.known_position-e.known_position),this.logoot_bst=new r.Bst((t,e)=>t.start.cmp(e.start)),this.removal_bst=new r.Bst((t,e)=>t.start.cmp(e.start)),this.vector_clock=new i.LogootInt}insertLocal(t,e){s.debug.debug(`Insert into doc at ${t} + ${e}`);const o=this.ldoc_bst.getLteq({known_position:t-1}),r=this.ldoc_bst.getGteq({known_position:t});let l,a,c,h;if(o.length>1||r.length>1)throw new n.FatalError("Corrupt BST. There are multiple nodes at a position.");if(l=o[0]?o[0].data:void 0,a=r[0]?r[0].data:void 0,l&&l.known_end_position<t)throw new Error("Position cannot be added after the end of the document.");l&&l.length+l.known_position>t&&((a=new i.LogootNode).length=l.known_end_position-t,l.length=t-l.known_position,a.known_position=t,a.start=l.start.offsetLowest(l.length),a.rclk=new i.LogootInt(l.rclk),this.ldoc_bst.add(a),this.logoot_bst.add(a)),l&&(c=l.end),a&&(h=a.start);const u=new i.LogootNode;return u.start=new i.LogootPosition(e,c,h),u.known_position=t,u.rclk=new i.LogootInt(this.vector_clock),u.length=e,this.ldoc_bst.operateOnAllGteq({known_position:t},t=>{t.data.known_position+=e}),this.ldoc_bst.add(u),this.logoot_bst.add(u),{position:u.start,rclk:new i.LogootInt(this.vector_clock),length:e}}removeLocal(t,e){s.debug.debug(`Remove from doc at ${t} + ${e}`);const o=this.ldoc_bst.getRange({known_position:t},{known_position:t+e-1}).concat(this.ldoc_bst.getLteq({known_position:t-1})).sort((t,e)=>t.data.known_position-e.data.known_position),n=[];let r,l=0;o.forEach(({data:o})=>{let s=o.length,i=o.start;o.known_position<t&&(s-=t-o.known_position,i=i.offsetLowest(t-o.known_position)),o.known_position+o.length>t+e&&(s-=o.known_position+o.length-(t+e)),s<=0||(r&&0===r.cmp(i)?n[n.length-1].length+=s:n.push({start:i,length:s}),r=i.offsetLowest(s),o.known_position>t&&(o.start=o.start.offsetLowest(o.known_position-t)),o.length-=s,o.known_position-=l,l+=s,o.length<=0&&(this.logoot_bst.remove(o),this.ldoc_bst.remove(o)))}),this.ldoc_bst.operateOnAllGteq({known_position:t+e},t=>{t.data.known_position-=e});const a=new i.LogootInt(this.vector_clock);return this.vector_clock.add(1),{removals:n,rclk:a}}insertLogoot(t,e,o){s.debug.debug(`Insert into doc at ${t.toString()} + ${e} @ ${o.toString()}`),o.cmp(this.vector_clock)>0&&(this.vector_clock=o,s.debug.info(`Fast-forward vector clock to ${o.toString()}`));const r=l(this.logoot_bst,t,e,(t,e,n)=>t===n&&n.start.levels<e.level?0:t.rclk.cmp(o)<0?-1:(0===t.rclk.cmp(o)&&s.debug.info("Dropped conflicting node"),1),t=>{this.ldoc_bst.add(t),this.logoot_bst.add(t)},(t,e,o,n)=>{n&&(this.ldoc_bst.remove(t),this.logoot_bst.remove(t)),this.removeLocal(e,o),this.ldoc_bst.operateOnAllGteq({known_position:e},e=>{e.data!==t&&(e.data.known_position-=o)})});n.arraymap(r,t=>{let e=t.known_position;return l(this.removal_bst,t.start,t.length,t=>t.rclk.cmp(o)<0?0:1,()=>{},()=>{}).map(o=>(o.known_position=e,o.offset+=t.offset,e+=o.length,o))});const i=[];return r.forEach(t=>{t.rclk=o,this.ldoc_bst.operateOnAllGteq(t,e=>{e.data!==t&&(e.data.known_position+=t.length)});const e={known_position:t.known_position,offset:t.offset,length:t.length};i.push(e),this.ldoc_bst.add(t),this.logoot_bst.add(t)}),{insertions:i}}removeLogoot(t,e,o){const n=new i.LogootInt(o).add(1);n.cmp(this.vector_clock)>0&&(this.vector_clock=n,s.debug.info("Fast-forward vector clock to",JSON.stringify(n)));const r=t.offsetLowest(e),a=t.levels;s.debug.debug(`Remove from doc at ${t.toString()} + ${e} @ ${o.toString()}`);const c=[],h=l(this.logoot_bst,t,e,t=>t.rclk.cmp(o)<=0?-1:1,t=>{this.ldoc_bst.add(t),this.logoot_bst.add(t)},(t,e,o,n)=>{n&&(this.ldoc_bst.remove(t),this.logoot_bst.remove(t)),c.push({known_position:e,length:o}),this.ldoc_bst.operateOnAllGteq({known_position:e},e=>{e.data!==t&&(e.data.known_position-=o)})});h.push({start:r,end:r,length:0,known_position:0,known_end_position:0,rclk:new i.LogootInt,offset:0});let u=t;return h.forEach(t=>{const e=new i.LogootInt(t.end.l(a)).sub(u.l(a)).js_int;l(this.removal_bst,u,e,t=>t.rclk.cmp(o)<0?-1:1,t=>{this.removal_bst.add(t)},(t,e,o,n)=>{n&&this.removal_bst.remove(t)}).forEach(t=>{t.rclk=o,delete t.offset,this.removal_bst.add(t)}),u=t.end}),{removals:c}}}},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=o(0);class s{constructor(t){this.data=t}}e.BstNode=s;e.Bst=class{constructor(t){this.bst_root=void 0,this.cmp=t}gteqcmp(t,e){return this.cmp(t,e)>=0}gtcmp(t,e){return this.cmp(t,e)>0}eqcmp(t,e){return 0===this.cmp(t,e)}add(t,e=new n.MemberPtr(this,"bst_root")){e.value?this.gteqcmp(e.value.data,t)?this.add(t,new n.MemberPtr(e.value,"left")):this.add(t,new n.MemberPtr(e.value,"right")):e.value=new s(t)}_getInorderSuccessor(t,e=new n.MemberPtr(this,"bst_root")){let o;const s=t=>{(!o||t&&this.gtcmp(o.data,t.data))&&(o=t)};return e.value&&(this.gteqcmp(e.value.data,t)&&(this.eqcmp(e.value.data,t)||s({ptr:e,data:e.value.data}),s(this._getInorderSuccessor(t,new n.MemberPtr(e.value,"left")))),s(this._getInorderSuccessor(t,new n.MemberPtr(e.value,"right")))),o}remove(t,e=new n.MemberPtr(this,"bst_root")){if(e.value){const o=this.cmp(e.value.data,t);if(o>0)this.remove(t,new n.MemberPtr(e.value,"left"));else if(o<0)this.remove(t,new n.MemberPtr(e.value,"right"));else if(e.value.left&&e.value.right){const t=this._getInorderSuccessor(e.value.data,e);this.remove(t.data,t.ptr),e.value.data=t.data}else e.value=e.value.left||e.value.right}}operateOnAllRange(t,e,o,n=this.bst_root,s=!1){n&&!s&&(this.gteqcmp(n.data,t)?this.gteqcmp(e,n.data)?(this.operateOnAllRange(t,e,o,n.left,!n.left),this.operateOnAllRange(t,e,o,n.right,!n.right),o(n)):this.operateOnAllRange(t,e,o,n.left,!n.left):this.operateOnAllRange(t,e,o,n.right,!n.right))}operateOnAllGteq(t,e,o=new n.MemberPtr(this,"bst_root")){o.value&&(this.gteqcmp(o.value.data,t)&&(e(o.value),this.operateOnAllGteq(t,e,new n.MemberPtr(o.value,"left"))),this.operateOnAllGteq(t,e,new n.MemberPtr(o.value,"right")))}operateOnAllLteq(t,e,o=new n.MemberPtr(this,"bst_root")){o.value&&(this.gteqcmp(t,o.value.data)&&(e(o.value),this.operateOnAllLteq(t,e,new n.MemberPtr(o.value,"right"))),this.operateOnAllLteq(t,e,new n.MemberPtr(o.value,"left")))}operateOnAll(t,e=new n.MemberPtr(this,"bst_root")){e.value&&(this.operateOnAll(t,new n.MemberPtr(e.value,"left")),t(e.value),this.operateOnAll(t,new n.MemberPtr(e.value,"right")))}getRange(t,e){const o=[];return this.operateOnAllRange(t,e,t=>o.push(t)),o}getGteq(t){let e=[];return this.operateOnAllGteq(t,t=>{!e[0]||this.gtcmp(e[0].data,t.data)?e=[t]:this.eqcmp(e[0].data,t.data)&&e.push(t)}),e}getLteq(t){let e=[];return this.operateOnAllLteq(t,t=>{!e[0]||this.gtcmp(t.data,e[0].data)?e=[t]:this.eqcmp(e[0].data,t.data)&&e.push(t)}),e}toString(){let t="BST [\n";return this.operateOnAll(({data:e})=>{t+="  "+e.toString()+"\n"}),t+="]"}}},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=o(7).Int32;e.LogootInt=n;class s{constructor(t=0,e,o){if(this.start=e,this.end=o,this.array=[new n(0)],!e&&o)this.array=o.inverseOffsetLowest(t).array;else if(!o&&e)this.array=e.copy().array;else if(e&&o){let s=!1;const r=e.array.values(),i=o.array.values();let l,a;for(this.array.length=0;!s;)l&&l.done||(l=r.next()),a&&a.done||(a=i.next()),l.done||a.done?l.done?a.done?(this.array.push(new n),s=!0):(this.array.push(new n(a.value).sub(t)),s=!0):(this.array.push(new n(l.value)),s=!0):(a.value.gteq(new n(l.value).add(t))&&(s=!0),this.array.push(new n(l.value)))}}static fromJSON(t){const e=new s;return e.array.length=0,t.forEach(t=>{e.array.push(n.fromJSON(t))}),e}toJSON(){return this.array.map(t=>t.toJSON())}get length(){return this.array.length}get levels(){return this.length-1}level(t){return this.array[t]}l(t){return this.level(t)}offsetLowest(t){return Object.assign(new s,{array:this.array.map((e,o,s)=>o<s.length-1?e:new n(e).add(t))})}inverseOffsetLowest(t){return Object.assign(new s,{array:this.array.map((e,o,s)=>o<s.length-1?e:new n(e).sub(t))})}copy(){return Object.assign(new s,{array:this.array.map(t=>new n(t))})}equivalentPositionAtLevel(t){return Object.assign(new s,{array:new Array(t+1).fill(0,0,t+1).map((t,e)=>new n(this.array[e]))})}cmp(t,e=0){if(e>=this.length)return this.length===t.length?0:1;if(e>=t.length)return-1;switch(this.level(e).cmp(t.level(e))){case 1:return 1;case-1:return-1;case 0:return this.cmp(t,e+1);default:return 0}}clamp(t,e,o){const n=this.cmp(t)<0?t:this.cmp(e)>0?e:this;return void 0!==o?n.equivalentPositionAtLevel(o):n.copy()}toString(){let t="[";return this.array.forEach((e,o,n)=>{t+=e.toString()+(o>=n.length-1?"":",")}),t+="]"}}e.LogootPosition=s,function(t){let e;!function(t){t.Schema={type:"array",items:n.JSON.Schema}}(e=t.JSON||(t.JSON={}))}(s||(s={})),e.LogootPosition=s;e.LogootNode=class{constructor(t){this.known_position=0,this.length=0,this.start=new s,this.rclk=new n(0),t&&Object.assign(this,{known_position:t.known_position,length:t.length,start:t.start.offsetLowest(new n),rclk:new n(t.rclk)})}get end(){return this.start.offsetLowest(this.length)}get known_end_position(){return this.known_position+this.length}toString(){return this.start.toString()+("number"==typeof this.known_position?"("+this.known_position+")":"")+` + ${this.length} @ ${this.rclk}`}}},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=o(0);class s extends n.Comparable{}e.IntType=s;class r extends s{constructor(t=0){super(),this.int32=new Int32Array([0]),this.int32[0]=t instanceof r?t.int32[0]:t}static fromJSON(t){return new r(t)}toJSON(){return this.int32[0]}add(t){return this.int32[0]+=t instanceof r?t.int32[0]:t,this}sub(t){return this.int32[0]-=t instanceof r?t.int32[0]:t,this}cmp(t){return t instanceof r?(this.int32[0]>=t.int32[0]?1:0)+(this.int32[0]<=t.int32[0]?-1:0):(this.int32[0]>=t?1:0)+(this.int32[0]<=t?-1:0)}get js_int(){return this.int32[0]}toString(){return this.int32[0].toString()}}e.Int32=r,function(t){let e;!function(t){t.Schema={type:"number"}}(e=t.JSON||(t.JSON={}))}(r||(r={})),e.Int32=r}])}));
//# sourceMappingURL=logootish-js.min.js.map