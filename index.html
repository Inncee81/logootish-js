<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>logootish-js</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.js" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">logootish-js</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-externals" checked />
							<label class="tsd-widget" for="tsd-filter-externals">Externals</label>
							<input type="checkbox" id="tsd-filter-only-exported" />
							<label class="tsd-widget" for="tsd-filter-only-exported">Only exported</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<ul class="tsd-breadcrumb">
				<li>
					<a href="globals.html">Globals</a>
				</li>
			</ul>
			<h1> logootish-js</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#logootish" id="logootish" style="color: inherit; text-decoration: none;">
					<h1>Logootish</h1>
				</a>
				<p>The Logootish algorithm used by the Matrix Notepad. See the documentation
					<a href="https://github.com/KB1RD/matrix-notepad/wiki/Logootish">on the wiki.</a> Currently, this
					is only used in <code>matrix-notepad</code>, but the code is generic enough that it could
					be used in any collaboration system. The goal of Logootish is to ensure that
					concurrent edits can successfully be merged together in a collaboration system.
					Right now, this only supports ordered list types, such as strings or arrays, but
					I hope to expand it to support full JSON, which would include maps. At the
				moment, all APIs are subject to change.</p>
				<p>Based on <a href="https://github.com/krasimir/webpack-library-starter">https://github.com/krasimir/webpack-library-starter</a></p>
				<a href="#installation" id="installation" style="color: inherit; text-decoration: none;">
					<h2>Installation</h2>
				</a>
				<pre><code class="language-sh"><span class="hljs-comment"># Grab the repo</span>
git <span class="hljs-built_in">clone</span> https://github.com/KB1RD/logootish-js.git

<span class="hljs-comment"># Install packages</span>
yarn install

<span class="hljs-comment"># Build everything</span>
yarn run build
yarn run build:docs

<span class="hljs-comment"># Run tests (currently broken)</span>
yarn run <span class="hljs-built_in">test</span>
yarn run <span class="hljs-built_in">test</span>:watch
yarn run <span class="hljs-built_in">test</span>:cover

<span class="hljs-comment"># Link it so that you can build packages locally with your local copy</span>
yarn link</code></pre>
				<a href="#usage" id="usage" style="color: inherit; text-decoration: none;">
					<h2>Usage</h2>
				</a>
				<p>Currently, the <code>Document</code> class is to maintain backwards compatability. It will
					soon be restructured, so you shouldn&#39;t use it. Most of the program logic occurs
					in the new <code>ListDocumentModel</code> class, where most of the old document code was
					moved. The <code>ListDocumentModel</code> does not store anything, but is only a mapping
					between Logoot positions and indexes. Since it does not actually touch the data
					that you are ordering, you can use it to maintain consistency between <em>any</em> type
				of ordered data -- Arrays, text, etc.</p>
				<a href="#local-insertions" id="local-insertions" style="color: inherit; text-decoration: none;">
					<h3>Local Insertions</h3>
				</a>
				<pre><code class="language-javascript"><span class="hljs-keyword">const</span> { ListDocumentModel } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./dist/logootish-js.min.js'</span>)

<span class="hljs-keyword">const</span> m = <span class="hljs-keyword">new</span> ListDocumentModel()

<span class="hljs-keyword">let</span> { position, length, rclk } = m.insertLocal(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>)
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Inserted <span class="hljs-subst">${length}</span> elements at position <span class="hljs-subst">${position.toString()}</span> with a vector clock of <span class="hljs-subst">${rclk.toString()}</span>`</span>)
<span class="hljs-comment">// Prints `Inserted 2 elements at position [0] with a vector clock of 0`</span>

;({ position, length, rclk } = m.insertLocal(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>))
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Inserted <span class="hljs-subst">${length}</span> elements at position <span class="hljs-subst">${position.toString()}</span> with a vector clock of <span class="hljs-subst">${rclk.toString()}</span>`</span>)
<span class="hljs-comment">// Prints `Inserted 2 elements at position [1,0] with a vector clock of 0`</span></code></pre>
				<p>Keep in mind, this doesn&#39;t actually insert anything anywhere: It just keeps a
					record of where the new elements should go. In later examples, I will show how
				to work with actual data.</p>
				<a href="#local-removals" id="local-removals" style="color: inherit; text-decoration: none;">
					<h3>Local Removals</h3>
				</a>
				<pre><code class="language-javascript"><span class="hljs-keyword">const</span> { ListDocumentModel } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./dist/logootish-js.min.js'</span>)

<span class="hljs-keyword">const</span> m = <span class="hljs-keyword">new</span> ListDocumentModel()

m.insertLocal(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>)
m.insertLocal(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)

<span class="hljs-comment">// Currently, the model looks like this:</span>
<span class="hljs-comment">// Char 0 - [0]</span>
<span class="hljs-comment">// Char 1 - [1,0]</span>
<span class="hljs-comment">// Char 2 - [1,1]</span>
<span class="hljs-comment">// Char 3 - [1]</span>

<span class="hljs-keyword">const</span> { removals, rclk } = m.removeLocal(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>)
removals.forEach(<span class="hljs-function">(<span class="hljs-params">{ start, length }</span>) =&gt;</span> {
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Removed <span class="hljs-subst">${length}</span> elements at position <span class="hljs-subst">${start.toString()}</span>`</span>)
})
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">`...and all with the vector clock of <span class="hljs-subst">${rclk.toString()}</span>!`</span>)
<span class="hljs-comment">/* Prints:
 * Removed 1 elements at position [0]
 * Removed 1 elements at position [1,0]
 * ...and all with the vector clock of 0!
 */</span>

<span class="hljs-comment">// Now, the model looks like this:</span>
<span class="hljs-comment">// Char 0 - [1,1]</span>
<span class="hljs-comment">// Char 1 - [1]</span></code></pre>
				<a href="#putting-it-together" id="putting-it-together" style="color: inherit; text-decoration: none;">
					<h3>Putting it Together</h3>
				</a>
				<p>Now, with two models...</p>
				<pre><code class="language-javascript"><span class="hljs-keyword">const</span> { ListDocumentModel } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./dist/logootish-js.min.js'</span>)

<span class="hljs-keyword">const</span> m1 = <span class="hljs-keyword">new</span> ListDocumentModel()
<span class="hljs-keyword">const</span> m2 = <span class="hljs-keyword">new</span> ListDocumentModel()

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dualInsert</span>(<span class="hljs-params">pos, len</span>) </span>{
  <span class="hljs-keyword">let</span> { position, length, rclk } = m1.insertLocal(pos, len)
  <span class="hljs-keyword">return</span> m2.insertLogoot(position, length, rclk).insertions
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dualRemove</span>(<span class="hljs-params">pos, len</span>) </span>{
  <span class="hljs-keyword">let</span> { removals, rclk } = m2.removeLocal(pos, len)
  <span class="hljs-keyword">return</span> removals.map(<span class="hljs-function">(<span class="hljs-params">{ start, length }</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> m1.removeLogoot(start, length, rclk).removals
  })
}

<span class="hljs-built_in">console</span>.log(dualInsert(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>))
<span class="hljs-comment">// Prints `[ { known_position: 0, offset: 0, length: 2 } ]`</span>

<span class="hljs-built_in">console</span>.log(dualInsert(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>))
<span class="hljs-comment">// Prints `[ { known_position: 1, offset: 0, length: 2 } ]`</span>

<span class="hljs-built_in">console</span>.log(dualRemove(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>))
<span class="hljs-comment">/* Prints:
 * [
 *   [ { known_position: 0, length: 1 } ],
 *   [ { known_position: 0, length: 1 } ]
 * ]
 */</span></code></pre>
				<p>Note how the positions are always the same as what&#39;s passed in as the arguments.
					This way, both document models look the same! Finally, note how both removals
					have the same <code>known_position</code>. This is because they are designed to be applied
					in sequence. So once the first element is removed, it&#39;s successor becomes the
				next one with the <code>known_position</code> equal to <code>0</code>.</p>
				<a href="#real-concurrent-edits" id="real-concurrent-edits" style="color: inherit; text-decoration: none;">
					<h3>Real Concurrent Edits</h3>
				</a>
				<p>Arrays are used here because of the easy <code>slice</code> and <code>splice</code> functions.</p>
				<pre><code><span class="hljs-keyword">const</span> { ListDocumentModel } = require(<span class="hljs-string">'./dist/logootish-js.min.js'</span>)

<span class="hljs-comment">// First, define two parallel documents. Normally these would be on seperate</span>
<span class="hljs-comment">// computers or at least seperate processes.</span>
<span class="hljs-keyword">const</span> docs = [
  {
    object: [],
    model: <span class="hljs-keyword">new</span> ListDocumentModel()
  },
  {
    object: [],
    model: <span class="hljs-keyword">new</span> ListDocumentModel()
  }
]

<span class="hljs-comment">// Define a function to insert `newelements` at `known_position`. The document</span>
<span class="hljs-comment">// `current` is modified directly and used as a source for the edits, which are</span>
<span class="hljs-comment">// translated to Logoot positions and used to modify all the `other` documents</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">insert</span><span class="hljs-params">(known_position, newelements, current, <span class="hljs-rest_arg">...other</span>)</span> </span>{
  <span class="hljs-comment">// First, add the items locally...</span>
  current.object.splice(known_position, <span class="hljs-number">0</span>, ...newelements)

  <span class="hljs-comment">// Now, update the model</span>
  <span class="hljs-keyword">const</span> { position, length, rclk } = current.model.insertLocal(
    known_position,
    newelements.length
  )

  <span class="hljs-comment">// Now, let the other models know and update the objects</span>
  other.forEach(({ object, model }) =&gt; {
    <span class="hljs-keyword">const</span> { insertions } = model.insertLogoot(position, length, rclk)
    insertions.forEach(({ known_position, offset, length }) =&gt; {
      <span class="hljs-comment">// The thing I didn't mention before was the offset. That's just the start</span>
      <span class="hljs-comment">// of the section of our source data that we're pulling from.</span>
      <span class="hljs-keyword">const</span> section = newelements.slice(offset, length + offset)
      object.splice(known_position, <span class="hljs-number">0</span>, ...section)
    })
  })
}

<span class="hljs-comment">// This is pretty much the same as the `insert` function, except it removes</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">remove</span><span class="hljs-params">(known_position, length, current, <span class="hljs-rest_arg">...other</span>)</span> </span>{
  <span class="hljs-comment">// First, remove the items locally...</span>
  current.object.splice(known_position, length)

  <span class="hljs-comment">// Now, update the model</span>
  <span class="hljs-keyword">const</span> { removals, rclk } = current.model.removeLocal(known_position, length)

  <span class="hljs-comment">// Now, let the other models know and update the objects</span>
  <span class="hljs-comment">// Ok, yeah this is kind of a lot of nesting</span>
  other.forEach(({ object, model }) =&gt; { <span class="hljs-comment">// For each object-model pair...</span>
    removals.forEach(({ start, length }) =&gt; { <span class="hljs-comment">// For each removal...</span>
      <span class="hljs-keyword">const</span> { removals } = model.removeLogoot(start, length, rclk)
      removals.forEach(({ known_position, length }) =&gt; {
        <span class="hljs-comment">// Now, for each segment we have to remove...</span>
        <span class="hljs-comment">// ... remove it from the object</span>
        object.splice(known_position, length)
      })
    })
  })
}

console.log(<span class="hljs-string">'First addition:'</span>)
insert(<span class="hljs-number">0</span>, [<span class="hljs-string">'a'</span>, <span class="hljs-string">'e'</span>, <span class="hljs-string">'f'</span>], docs[<span class="hljs-number">0</span>], docs[<span class="hljs-number">1</span>])
console.log(docs[<span class="hljs-number">0</span>].object)
console.log(docs[<span class="hljs-number">1</span>].object)

console.log(<span class="hljs-string">'Second addition:'</span>)
insert(<span class="hljs-number">1</span>, [<span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>, <span class="hljs-string">'d'</span>], docs[<span class="hljs-number">0</span>], docs[<span class="hljs-number">1</span>])
console.log(docs[<span class="hljs-number">0</span>].object)
console.log(docs[<span class="hljs-number">1</span>].object)

console.log(<span class="hljs-string">'Removal:'</span>)
remove(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>, docs[<span class="hljs-number">0</span>], docs[<span class="hljs-number">1</span>])
console.log(docs[<span class="hljs-number">0</span>].object)
console.log(docs[<span class="hljs-number">1</span>].object)</code></pre><p>Which prints:</p>
				<pre><code><span class="hljs-symbol">First</span> addition:
[ <span class="hljs-string">'a'</span>, <span class="hljs-string">'e'</span>, <span class="hljs-string">'f'</span> ]
[ <span class="hljs-string">'a'</span>, <span class="hljs-string">'e'</span>, <span class="hljs-string">'f'</span> ]
<span class="hljs-symbol">Second</span> addition:
[ <span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>, <span class="hljs-string">'d'</span>, <span class="hljs-string">'e'</span>, <span class="hljs-string">'f'</span> ]
[ <span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>, <span class="hljs-string">'d'</span>, <span class="hljs-string">'e'</span>, <span class="hljs-string">'f'</span> ]
<span class="hljs-symbol">Removal</span>:
[ <span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span> ]
[ <span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span> ]</code></pre><p>And there you have it! Matrix Notepad is basically the above code, except...</p>
				<ul>
					<li>The documents are on different systems.</li>
					<li>Both the data from <code>insertLocal</code> or <code>removeLocal</code> is put into a Matrix event,
					along with the <code>newelements</code> in the case of insertions.</li>
					<li>There&#39;s a fancy GUI.</li>
				</ul>
				<a href="#conflicts" id="conflicts" style="color: inherit; text-decoration: none;">
					<h2>Conflicts</h2>
				</a>
				<p>Right now, there is no conflict resolution. I have a work-in-progress solution
					to this, but it will warrant significant API changes. <strong>Until I get past major
						version 0, consider all APIs unstable, as per the
				<a href="https://semver.org/">semantic versioning spec</a>.</strong></p>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class="globals  ">
						<a href="globals.html"><em>Globals</em></a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_bst_.html">&quot;bst&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_debug_.html">&quot;debug&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_index_.html">&quot;index&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_ints_.html">&quot;ints&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_listmodel_index_.html">&quot;listmodel/index&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_listmodel_logoot_.html">&quot;listmodel/logoot&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_utils_.html">&quot;utils&quot;</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-module"><span class="tsd-kind-icon">Module</span></li>
				<li class="tsd-kind-object-literal"><span class="tsd-kind-icon">Object literal</span></li>
				<li class="tsd-kind-variable"><span class="tsd-kind-icon">Variable</span></li>
				<li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li>
				<li class="tsd-kind-function tsd-has-type-parameter"><span class="tsd-kind-icon">Function with type parameter</span></li>
				<li class="tsd-kind-index-signature"><span class="tsd-kind-icon">Index signature</span></li>
				<li class="tsd-kind-type-alias"><span class="tsd-kind-icon">Type alias</span></li>
				<li class="tsd-kind-type-alias tsd-has-type-parameter"><span class="tsd-kind-icon">Type alias with type parameter</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-enum"><span class="tsd-kind-icon">Enumeration</span></li>
				<li class="tsd-kind-enum-member"><span class="tsd-kind-icon">Enumeration member</span></li>
				<li class="tsd-kind-property tsd-parent-kind-enum"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-enum"><span class="tsd-kind-icon">Method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-interface"><span class="tsd-kind-icon">Interface</span></li>
				<li class="tsd-kind-interface tsd-has-type-parameter"><span class="tsd-kind-icon">Interface with type parameter</span></li>
				<li class="tsd-kind-constructor tsd-parent-kind-interface"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-interface"><span class="tsd-kind-icon">Method</span></li>
				<li class="tsd-kind-index-signature tsd-parent-kind-interface"><span class="tsd-kind-icon">Index signature</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-class"><span class="tsd-kind-icon">Class</span></li>
				<li class="tsd-kind-class tsd-has-type-parameter"><span class="tsd-kind-icon">Class with type parameter</span></li>
				<li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class"><span class="tsd-kind-icon">Accessor</span></li>
				<li class="tsd-kind-index-signature tsd-parent-kind-class"><span class="tsd-kind-icon">Index signature</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-constructor tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited accessor</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected accessor</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private accessor</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static property</span></li>
				<li class="tsd-kind-call-signature tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static method</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
<script>if (location.protocol == 'file:') document.write('<script src="assets/js/search.js"><' + '/script>');</script>
</body>
</html>